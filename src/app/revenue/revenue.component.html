

<div class="revenue-dashboard">
  <!-- Controls Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="row align-items-end mb-2">
        <div class="col-12 col-md-6 mb-2 mb-md-0">
          <div class="input-group">
           
            <input type="text" class="form-control" placeholder="Search by name, area, or room type..."
            [(ngModel)]="searchTerm" (keyup.enter)="performSearch()" >
              <span (click)="performSearch()" class="cursor-pointer input-group-text"><i class="fas fa-search"></i></span>
          </div>
        </div> 
        <div class="col-12 col-md-3 mb-2 mb-md-0">
          <div class="d-flex gap-2 flex-wrap">
            <button class="btn btn-outline-secondary" (click)="openFilterModal()" [class.btn-primary]="hasActiveFilters()"
              [class.text-white]="hasActiveFilters()">
              <i class="fas fa-filter me-2"></i>
              Filters
              <span *ngIf="getActiveFilterCount() > 0" class="badge bg-white  ms-2">
                {{ getActiveFilterCount() }}
              </span>
            </button>
            
            <!-- Filter Presets Dropdown -->
            <div class="dropdown">
              <button class="btn btn-outline-info dropdown-toggle" type="button" id="filterPresetsDropdown"
                data-bs-toggle="dropdown" aria-expanded="false" title="Filter Presets">
                <i class="fas fa-bookmark me-1"></i>
                Presets
              </button>
              <div class="dropdown-menu dropdown-menu-end filter-presets-dropdown" aria-labelledby="filterPresetsDropdown">
                <div class="dropdown-header">
                  <strong>Filter Presets</strong>
                </div>
                
                <!-- Quick Apply Presets -->
                <div *ngIf="filterPresets.length > 0" class="preset-list">
                  <div *ngFor="let preset of filterPresets" class="dropdown-item preset-item" (click)="selectedPresetId = preset.id; onPresetSelectionChange()" [class.selected]="selectedPresetId === preset.id">
                    <div class="preset-info">
                      <div class="preset-name">
                        <i class="fas fa-bookmark  me-2"></i>
                        {{ preset.name }}
                        <span *ngIf="selectedPresetId === preset.id" class="badge bg-success ms-2">Selected</span>
                      </div>
                      <div class="preset-summary">
                        <small class="text-muted">{{ getPresetSummary(preset).slice(0, 2).join(', ') }}
                          <span *ngIf="getPresetSummary(preset).length > 2">...</span>
                        </small>
                      </div>
                    </div>
                    <div class="preset-actions">
                      <button class="btn btn-sm btn-outline-danger" (click)="$event.stopPropagation(); deletePreset(preset.id)" 
                        [disabled]="presetDeleting" title="Delete preset">
                        <i *ngIf="!presetDeleting" class="fas fa-trash"></i>
                        <i *ngIf="presetDeleting" class="fas fa-spinner fa-spin"></i>
                      </button>
                    </div>
                  </div>
                </div>
                
                <div *ngIf="filterPresets.length === 0" class="dropdown-item-text text-muted">
                  No saved presets
                </div>
                
               
                
                <div class="dropdown-divider"></div>
                
                <!-- Preset Management Actions -->
                <div class="dropdown-item-text px-3 py-2">
                  <div class="btn-group btn-group-sm w-100" role="group">
                    <button type="button" class="btn btn-outline-success me-1" (click)="showSavePresetDialog()" 
                      [disabled]="(!hasActiveFilters() && getCurrentPropertyIds().length === 0) || presetSaving" 
                      title="Save current filters or property selection as preset">
                      <i *ngIf="!presetSaving" class="fas fa-save me-1"></i>
                      <i *ngIf="presetSaving" class="fas fa-spinner fa-spin me-1"></i>Save
                    </button>
                    <button type="button" class="btn btn-outline-secondary ms-1" (click)="togglePresetManagement()"
                      title="Manage presets">
                      <i class="fas fa-cog me-1"></i>Manage
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-3">
          <div class="d-flex gap-2 flex-wrap justify-content-md-end">


            <button class="btn btn-outline-success" 
                    (click)="exportToCSV()" 
                    [disabled]="exportLoading" 
                    title="Export to CSV">
              <div *ngIf="exportLoading" class="spinner-border spinner-border-sm me-2" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <i class="fas fa-download me-2" *ngIf="!exportLoading"></i>
              Export CSV
            </button>
            <div class="dropdown">
              <button class="btn btn-outline-info dropdown-toggle" type="button" id="columnVisibilityDropdown"
                data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fas fa-columns me-2"></i>
                Columns ({{ getVisibleColumnsCount() }})
              </button>
              <div class="dropdown-menu dropdown-menu-end column-visibility-dropdown"
                aria-labelledby="columnVisibilityDropdown">
                <div class="dropdown-header">
                  <strong>Show/Hide Columns</strong>
                </div>

                <!-- Quick Actions -->
                <div class="dropdown-item-text px-3 py-2 border-bottom" (click)="$event.stopPropagation()">
                  <div class="btn-group btn-group-sm w-100" role="group">
                    <button type="button" class="btn btn-outline-secondary" (click)="resetToDefaultColumns()">
                      Default
                    </button>
                    <button type="button" class="btn btn-outline-success" (click)="showAllColumns()">
                      All
                    </button>
                    <button type="button" class="btn btn-outline-danger" (click)="hideAllColumns()">
                      None
                    </button>
                  </div>
                </div>

                <!-- Column Checkboxes -->
                <div class="column-checkboxes px-3">
                  <div class="form-check dropdown-item" (click)="$event.stopPropagation()">
                    <input class="form-check-input" type="checkbox" id="col-propertyName"
                      [(ngModel)]="columnVisibility.propertyName" disabled>
                    <label class="form-check-label">
                      Property Name
                    </label>
                  </div>

                  <div class="form-check dropdown-item" (click)="$event.stopPropagation()">
                    <input class="form-check-input" type="checkbox" id="col-occupancyTM"
                      [(ngModel)]="columnVisibility.occupancyTM">
                    <label class="form-check-label">
                      Occupancy TM
                    </label>
                  </div>

                  <div class="form-check dropdown-item" (click)="$event.stopPropagation()">
                    <input class="form-check-input" type="checkbox" id="col-occupancyNM"
                      [(ngModel)]="columnVisibility.occupancyNM">
                    <label class="form-check-label">
                      Occupancy NM
                    </label>
                  </div>

                  <div class="form-check dropdown-item" (click)="$event.stopPropagation()">
                    <input class="form-check-input" type="checkbox" id="col-adr" [(ngModel)]="columnVisibility.adr">
                    <label class="form-check-label">
                      ADR
                    </label>
                  </div>

                  <div class="form-check dropdown-item" (click)="$event.stopPropagation()">
                    <input class="form-check-input" type="checkbox" id="col-revpar"
                      [(ngModel)]="columnVisibility.revpar">
                    <label class="form-check-label">
                      RevPAR
                    </label>
                  </div>

                  <div class="form-check dropdown-item" (click)="$event.stopPropagation()">
                    <input class="form-check-input" type="checkbox" id="col-mpi" [(ngModel)]="columnVisibility.mpi">
                    <label class="form-check-label">
                      MPI
                    </label>
                  </div>

                  <div class="form-check dropdown-item" (click)="$event.stopPropagation()">
                    <input class="form-check-input" type="checkbox" id="col-reviews"
                      [(ngModel)]="columnVisibility.reviews">
                    <label class="form-check-label">
                      Reviews
                    </label>
                  </div>

                  <div class="form-check dropdown-item" (click)="$event.stopPropagation()">
                    <input class="form-check-input" type="checkbox" id="col-cxlPolicy"
                      [(ngModel)]="columnVisibility.cxlPolicy">
                    <label class="form-check-label">
                      CXL Policy
                    </label>
                  </div>

                  <div class="form-check dropdown-item" (click)="$event.stopPropagation()">
                    <input class="form-check-input" type="checkbox" id="col-adultChildConfig"
                      [(ngModel)]="columnVisibility.adultChildConfig">
                    <label class="form-check-label">
                      Adult Child Config
                    </label>
                  </div>

                  <div class="form-check dropdown-item" (click)="$event.stopPropagation()">
                    <input class="form-check-input" type="checkbox" id="col-pickupOcc"
                      [(ngModel)]="columnVisibility.pickupOcc">
                    <label class="form-check-label">
                      Pick up Occ
                    </label>
                  </div>

                  <div class="form-check dropdown-item" (click)="$event.stopPropagation()">
                    <input class="form-check-input" type="checkbox" id="col-minRateThreshold"
                      [(ngModel)]="columnVisibility.minRateThreshold">
                    <label class="form-check-label">
                      Min Rate Threshold
                    </label>
                  </div>

                  <div class="form-check dropdown-item" (click)="$event.stopPropagation()">
                    <input class="form-check-input" type="checkbox" id="col-stlyVarOcc"
                      [(ngModel)]="columnVisibility.stlyVarOcc">
                    <label class="form-check-label">
                      STLY Var Occ
                    </label>
                  </div>

                  <div class="form-check dropdown-item" (click)="$event.stopPropagation()">
                    <input class="form-check-input" type="checkbox" id="col-stlyVarRevPAR"
                      [(ngModel)]="columnVisibility.stlyVarRevPAR">
                    <label class="form-check-label">
                      STLY Var RevPAR
                    </label>
                  </div>

                  <div class="form-check dropdown-item" (click)="$event.stopPropagation()">
                    <input class="form-check-input" type="checkbox" id="col-lastReviewScore"
                      [(ngModel)]="columnVisibility.lastReviewScore">
                    <label class="form-check-label">
                      Last Review Score
                    </label>
                  </div>

                  <div class="form-check dropdown-item" (click)="$event.stopPropagation()">
                    <input class="form-check-input" type="checkbox" id="col-lastReviewDate"
                      [(ngModel)]="columnVisibility.lastReviewDate">
                    <label class="form-check-label">
                      Last Review Date
                    </label>
                  </div>

                  <div class="form-check dropdown-item" (click)="$event.stopPropagation()">
                    <input class="form-check-input" type="checkbox" id="col-actions"
                      [(ngModel)]="columnVisibility.actions" disabled>
                    <label class="form-check-label">
                      Deep Dive
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Applied Filters Section -->
    <div class="applied-filters-section" *ngIf="getAppliedFilters().length > 0">
      <div class="applied-filters-card">
        <div class="filters-header">
          <h6 class="mb-0">
            <i class="fas fa-filter me-2"></i>Applied Filters ({{ getAppliedFilters().length }})
            <span *ngIf="getSelectedPropertiesCount() > 0" class="ms-2">
              <i class="fas fa-check-square me-1"></i>Selected Properties ({{ getSelectedPropertiesCount() }})
            </span>
          </h6>
          <div class="filter-actions">
            <button class="btn btn-sm btn-outline-success me-2" (click)="showSavePresetDialog()" 
              [disabled]="(!hasActiveFilters() && getCurrentPropertyIds().length === 0) || presetSaving" 
              title="Save current filters or property selection as preset">
              <i *ngIf="!presetSaving" class="fas fa-bookmark me-1"></i>
              <i *ngIf="presetSaving" class="fas fa-spinner fa-spin me-1"></i>Save as Preset
            </button>
            <button class="btn btn-sm btn-outline-warning me-2" (click)="clearPropertySelection()" 
              [disabled]="getSelectedPropertiesCount() === 0"
              title="Clear property selection">
              <i class="fas fa-check-square me-1"></i>Clear Selection
            </button>
            <button class="btn btn-sm me-2" 
              [class.btn-primary]="!showOnlySelected"
              [class.btn-success]="showOnlySelected"
              (click)="toggleShowOnlySelected()" 
              [disabled]="!shouldShowToggleButton()"
              [title]="showOnlySelected ? 'Show all properties' : 'Show only selected properties'">
              <i [class]="showOnlySelected ? 'fas fa-filter me-1' : 'fas fa-eye me-1'"></i>
              {{ showOnlySelected ? 'Show All' : 'Show Selected Only' }}
            </button>
            <button class="btn btn-sm btn-outline-danger" (click)="clearAllFilters()">
              <i class="fas fa-times me-1"></i>Clear All
            </button>
          </div>
        </div>
        <div class="filters-badges">
          <span *ngFor="let filter of getAppliedFilters()" class="filter-badge" [ngClass]="'filter-' + filter.type">
            <span class="filter-label">{{ filter.label }}:</span>
            <span class="filter-value">{{ filter.value }}</span>
            <button class="remove-filter" (click)="removeFilter(filter.key)" title="Remove filter">
              <i class="fas fa-times"></i>
            </button>
          </span>
        </div>
      </div>
    </div>


    <!-- Loading State -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border " role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3">Loading properties...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="alert alert-danger" role="alert">
      <h4 class="alert-heading">Error!</h4>
      <p>{{ error }}</p>
      <hr>
      <button class="btn btn-outline-danger" (click)="refreshData()">
        <i class="fas fa-refresh me-2"></i>Try Again
      </button>
    </div>


    <!-- Table View -->
    <div class="table-container" *ngIf="!loading && !error && getFilteredPropertyData() && getFilteredPropertyData().length > 0" (scroll)="onScroll($event)">
      <table>
        <thead>
          <tr>
            <th class="select-column" *ngIf="hasActiveFilters()">
              <input type="checkbox" 
                     [(ngModel)]="selectAllProperties" 
                     (change)="toggleSelectAllProperties()"
                     [indeterminate]="getSelectedPropertiesCount() > 0 && getSelectedPropertiesCount() < getFilteredPropertyData().length"
                     title="Select/Deselect all visible properties">
            </th>
            <th *ngIf="columnVisibility.propertyName">Property Name</th>
            <th *ngIf="columnVisibility.occupancyTM">Occupancy TM</th>
                <th *ngIf="columnVisibility.occupancyNM">Occupancy NM</th>
                <th *ngIf="columnVisibility.adr">ADR</th>
                <th *ngIf="columnVisibility.revpar">RevPAR</th>
                <th *ngIf="columnVisibility.mpi">MPI</th>
                <th *ngIf="columnVisibility.reviews">Reviews</th>
                <th *ngIf="columnVisibility.cxlPolicy">CXL Policy</th>
                <th *ngIf="columnVisibility.adultChildConfig">Adult Child</th>
                <th *ngIf="columnVisibility.pickupOcc">Pick up Occ</th>
                <th *ngIf="columnVisibility.minRateThreshold">Min Rate <br /> Threshold</th>
                <th *ngIf="columnVisibility.stlyVarOcc">STLY <br />Var Occ</th>
                <th *ngIf="columnVisibility.stlyVarRevPAR">STLY Var <br /> RevPAR</th>
                <th *ngIf="columnVisibility.lastReviewScore">Last Review <br /> Score</th>
                <th *ngIf="columnVisibility.lastReviewDate">Last Review <br /> Date</th>
                <th *ngIf="columnVisibility.actions">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let property of getFilteredPropertyData()">
            <td class="select-column" *ngIf="hasActiveFilters()">
              <input type="checkbox" 
                     [checked]="isPropertySelected(property._id)"
                     (change)="togglePropertySelection(property._id)"
                     [disabled]="!property._id"
                     title="Select this property">
            </td>
            <td class="property-cell" *ngIf="columnVisibility.propertyName">
              <div class="property-info">
                <div class="property-image">
                  <img [src]="getPropertyImage(property)" [alt]="property.Listing_Name" 
                       (error)="onImageError($event)" class="property-thumbnail">
                </div>
                <div class="property-details">
                  <h4 [title]="property.Listing_Name" [attr.aria-label]="property.Listing_Name">{{ property.Listing_Name }}</h4>
                  <div class="property-links">
                    <!-- Airbnb Link -->
                    <a *ngIf="property.AirbnbUrl" [href]="property.AirbnbUrl" target="_blank" class="platform-link airbnb" title="View on Airbnb">
                      <i class="fab fa-airbnb"></i>
                    </a>
                    <span *ngIf="!property.AirbnbUrl" class="platform-link airbnb disabled" title="No Airbnb URL available">
                      <i class="fab fa-airbnb"></i>
                    </span>
                    
                    <!-- Booking.com Link -->
                    <a *ngIf="property.BookingUrl" [href]="property.BookingUrl" target="_blank" class="platform-link booking" title="View on Booking.com">
                      <i class="fas fa-bed"></i>
                    </a>
                    <span *ngIf="!property.BookingUrl" class="platform-link booking disabled" title="No Booking.com URL available">
                      <i class="fas fa-bed"></i>
                    </span>
                    
                    <!-- VRBO Link -->
                    <!-- <a *ngIf="property.VRBOUrl" [href]="property.VRBOUrl" target="_blank" class="platform-link vrbo" title="View on VRBO">
                      <i class="fas fa-home"></i>
                    </a> -->
                    <!-- <span *ngIf="!property.VRBOUrl" class="platform-link vrbo disabled" title="No VRBO URL available">
                      <i class="fas fa-home"></i>
                    </span> -->
                    
                    <!-- Pricelab Link -->
                    <a *ngIf="property.PricelabsUrl" [href]="property.PricelabsUrl" target="_blank" class="platform-link pricelab" title="View on Pricelab">
                      <i class="fas fa-chart-line"></i>
                    </a>
                    <span *ngIf="!property.PricelabsUrl" class="platform-link pricelab disabled" title="No Pricelab URL available">
                      <i class="fas fa-chart-line"></i>
                    </span>
                  </div>
                </div>
              </div>
            </td>
            <td *ngIf="columnVisibility.occupancyTM">
              <div class="occupancy-cell" *ngIf="property.Occupancy">
                <circle-progress [percent]="safeParseNumber(property.Occupancy.TM)" [radius]="24" [backgroundPadding]="-3" [backgroundStroke]="'#ccc'" [backgroundStrokeWidth]="6"
                  [outerStrokeWidth]="6" [innerStrokeWidth]="0" [outerStrokeColor]="getOccupancyColor(safeParseNumber(property.Occupancy.TM))"
                  [innerStrokeColor]="getOccupancyColor(safeParseNumber(property.Occupancy.TM), true)" [animation]="true" [animationDuration]="300" [showUnits]="false"
                  [showSubtitle]="false" [title]="safeParseNumber(property.Occupancy.TM) + '%'"
                  [titleFontSize]="'8px'" [titleColor]="getOccupancyColor(safeParseNumber(property.Occupancy.TM))" [titleFontWeight]="'900'">
                </circle-progress>
              </div>
              <div class="occupancy-cell" *ngIf="!property.Occupancy">
                <span class="text-muted">N/A</span>
              </div>
            </td>
            <td *ngIf="columnVisibility.occupancyNM">
              <div class="occupancy-cell" *ngIf="property.Occupancy">
                <circle-progress [percent]="safeParseNumber(property.Occupancy.NM)" [radius]="24" [backgroundPadding]="-3" [backgroundStroke]="'#ccc'" [backgroundStrokeWidth]="6"
                  [outerStrokeWidth]="6" [innerStrokeWidth]="0" [outerStrokeColor]="getOccupancyColor(safeParseNumber(property.Occupancy.NM))" 
                  [innerStrokeColor]="getOccupancyColor(safeParseNumber(property.Occupancy.NM), true)" [animation]="true" [animationDuration]="300" [showUnits]="false"
                  [showSubtitle]="false" [title]="safeParseNumber(property.Occupancy.NM) + '%'"
                  [titleFontSize]="'8px'" [titleColor]="getOccupancyColor(safeParseNumber(property.Occupancy.NM))" [titleFontWeight]="'900'">
                </circle-progress>
              </div>
              <div class="occupancy-cell" *ngIf="!property.Occupancy">
                <span class="text-muted">N/A</span>
              </div>
            </td>
            <td *ngIf="columnVisibility.adr">
              <div class="dual-value-cell">
                <div class="value-pair" *ngIf="property.ADR">
                  <span class="badge badge-light-gray me-1">TM: ${{ property.ADR.TM || 'N/A'
                    }}</span>
                  <span class="badge badge-light-gray">NM: ${{ property.ADR.NM || 'N/A'
                    }}</span>
                </div>
                <div class="value-pair" *ngIf="!property.ADR">
                  <span class="text-muted">N/A</span>
                </div>
              </div>
            </td>
            <td *ngIf="columnVisibility.revpar">
              <div class="dual-value-cell">
                <div class="value-pair" *ngIf="property.RevPAR">
                  <span class="badge badge-light-gray me-1">TM: ${{ property.RevPAR.TM || 'N/A'
                    }}</span>
                  <span class="badge badge-light-gray">NM: ${{ property.RevPAR.NM || 'N/A'
                    }}</span>
                </div>
                <div class="value-pair" *ngIf="!property.RevPAR">
                  <span class="text-muted">N/A</span>
                </div>
              </div>
            </td>
            <td *ngIf="columnVisibility.mpi">
              <div class="dual-value-cell">
                <div class="value-pair" *ngIf="property.MPI">
                  <span class="badge badge-light-gray me-1">TM: {{ safeParseNumber(property.MPI.TM) }}%</span>
                  <span class="badge badge-light-gray me-1">NM: {{ safeParseNumber(property.MPI.NM) }}%</span>
                  <span class="badge badge-light-gray me-1">LYTM: {{ safeParseNumber(property.MPI.LYTM) }}%</span>
                </div>
                <div class="value-pair" *ngIf="!property.MPI">
                  <span class="text-muted">N/A</span>
                </div>
              </div>
            </td>
            <td *ngIf="columnVisibility.reviews">
              <div class="reviews-cell-compact">
                <!-- Booking.com Reviews -->
                <div class="review-item clickable" *ngIf="safeParseNumber(property.Reviews?.Booking?.Rev_Score) > 0"
                  title="Booking.com: {{ property.Reviews.Booking.Rev_Score }}/10 ({{ property.Reviews.Booking.Total_Rev }} reviews) - Click to visit property"
                  (click)="openPropertyUrl(property, 'Booking')">
                  <i class="fas fa-bed "></i>
                  <div class="stars">
                    <i *ngFor="let star of getStarArray(property.Reviews.Booking.Rev_Score || 0, 10)" class="fas fa-star"
                      [ngClass]="star.filled ? 'star-filled' : 'star-empty'"></i>
                  </div>
                  <span class="rating-text">{{ property.Reviews.Booking.Rev_Score }}</span>
                </div>
                <div class="review-item no-reviews" *ngIf="safeParseNumber(property.Reviews.Booking.Rev_Score) === 0"
                  title="Booking.com: No reviews">
                  <i class="fas fa-bed text-muted"></i>
                  <span class="no-reviews-text" style="font-size: var(--font-size-xs);">No Reviews</span>
                </div>

                <!-- Airbnb Reviews -->
                <div class="review-item clickable" *ngIf="safeParseNumber(property.Reviews.Airbnb.Rev_Score) > 0"
                  title="Airbnb: {{ property.Reviews.Airbnb.Rev_Score }}/5 ({{ property.Reviews.Airbnb.Total_Rev }} reviews) - Click to visit property"
                  (click)="openPropertyUrl(property, 'Airbnb')">
                  <i class="fab fa-airbnb text-danger"></i>
                  <div class="stars">
                    <i *ngFor="let star of getStarArray(property.Reviews.Airbnb.Rev_Score || 0, 5)" class="fas fa-star"
                      [ngClass]="star.filled ? 'star-filled' : 'star-empty'"></i>
                  </div>
                  <span class="rating-text">{{ property.Reviews.Airbnb.Rev_Score }}</span>
                </div>
                <div class="review-item no-reviews" *ngIf="safeParseNumber(property.Reviews.Airbnb.Rev_Score) === 0"
                  title="Airbnb: No reviews">
                  <i class="fab fa-airbnb text-muted"></i>
                  <span class="no-reviews-text" style="font-size: var(--font-size-xs);">No Reviews</span>
                </div>

                <!-- VRBO Reviews -->
                <!-- <div class="review-item clickable" *ngIf="safeParseNumber(property.Reviews?.VRBO?.Rev_Score) > 0"
                  title="VRBO: {{ property.Reviews.VRBO.Rev_Score }}/5 ({{ property.Reviews.VRBO.Total_Rev }} reviews) - Click to visit property"
                  (click)="openPropertyUrl(property, 'VRBO')">
                  <i class="fas fa-home text-warning"></i>
                  <div class="stars">
                    <i *ngFor="let star of getStarArray(property.Reviews?.VRBO?.Rev_Score || 0, 5)" class="fas fa-star"
                      [ngClass]="star.filled ? 'star-filled' : 'star-empty'"></i>
                  </div>
                  <span class="rating-text">{{ property.Reviews.VRBO.Rev_Score }}</span>
                </div>

                <div class="review-item no-reviews" *ngIf="safeParseNumber(property.Reviews.VRBO.Rev_Score) === 0"
                  title="VRBO: No reviews">
                  <i class="fas fa-home text-muted"></i>
                  <span class="no-reviews-text" style="font-size: var(--font-size-xs);">No Reviews</span>
                </div> -->
              </div>
            </td>
            <td *ngIf="columnVisibility.cxlPolicy">
              <div class="cxl-policy-cell">
                <!-- Booking.com Policy -->
                <div class="policy-item" *ngIf="hasBookingPolicies(property.CXL_Policy?.Booking)">
                  <i class="fas fa-bed"></i>
                  <div class="policy-details">
                    <!-- Handle array format -->
                    <div *ngIf="isArray(property.CXL_Policy?.Booking)" class="policy-type">
                      <div *ngFor="let bookingPolicy of getBookingPoliciesArray(property.CXL_Policy?.Booking); let isLast = last" 
                           class="policy-item-row"
                           [class.general-policy]="bookingPolicy?.is_general_policy" 
                           [class.non-refundable]="bookingPolicy?.is_non_refundable_policy">
                        {{ bookingPolicy?.policy_group_title | formatText }}
                      </div>
                    </div>
                    <!-- Handle object format -->
                    <!-- <div class="policy-type" *ngIf="!isArray(property.CXL_Policy?.Booking)">
                      {{ property.CXL_Policy.Booking?.type | formatText }}
                    </div> -->
                  </div>
                </div>
                <div class="policy-item no-policy" *ngIf="!hasBookingPolicies(property.CXL_Policy?.Booking)">
                  <i class="fas fa-bed text-muted"></i>
                  <span class="no-policy-type" style="font-size: var(--font-size-xs);">No policy</span>
                </div>
                
                <!-- Airbnb Policy -->
                <div class="policy-item" *ngIf="hasValidAirbnbPolicy(property.CXL_Policy?.Airbnb)">
                  <i class="fab fa-airbnb text-danger"></i>
                  <div class="policy-details">
                    <div class="policy-type">{{ property.CXL_Policy.Airbnb?.type | formatText }}</div>
                    <!-- <div class="policy-description" *ngIf="property.CXL_Policy.Airbnb?.description">
                      {{ property.CXL_Policy.Airbnb?.description }}
                    </div>
                    <div class="policy-free-cancellation" *ngIf="property.CXL_Policy.Airbnb?.free_cancellation_until">
                      Free until: {{ property.CXL_Policy.Airbnb?.free_cancellation_until }}
                    </div> -->
                  </div>
                </div>
                <div class="policy-item no-policy" *ngIf="!hasValidAirbnbPolicy(property.CXL_Policy?.Airbnb)">
                  <i class="fab fa-airbnb text-muted"></i>
                  <span class="no-policy-type" style="font-size: var(--font-size-xs);">No policy</span>
                </div>
                
                <!-- VRBO Policy -->
                <div class="policy-item" *ngIf="property.CXL_Policy?.VRBO">
                  <i class="fas fa-home text-warning"></i>
                  <div class="policy-details">
                    <div class="policy-type">{{ property.CXL_Policy.VRBO?.type }}</div>
                    <div class="policy-description">{{ property.CXL_Policy.VRBO?.description }}</div>
                    <div class="policy-free-cancellation" *ngIf="property.CXL_Policy.VRBO?.free_cancellation_until">
                      Free until: {{ property.CXL_Policy.VRBO?.free_cancellation_until }}
                    </div>
                  </div>
                </div>
                <div class="policy-item no-policy" *ngIf="!property.CXL_Policy?.VRBO">
                  <i class="fas fa-home text-muted"></i>
                  <span class="no-policy-type" style="font-size: var(--font-size-xs);">No policy</span>
                </div>
              </div>
            </td>
            <td *ngIf="columnVisibility.adultChildConfig">
              <div class="adult-child-config-cell">
                <div class="config-item" *ngIf="property.Adult_Child_Config?.Booking">
                  <i class="fas fa-bed "></i>
                  <span class="config-text">Max guests: {{ formatGuestConfig(property.Adult_Child_Config.Booking) }}</span>
                </div>
                <div class="config-item" *ngIf="property.Adult_Child_Config?.Airbnb">
                  <i class="fab fa-airbnb text-danger"></i>
                  <span class="config-text">Max guests: {{ formatGuestConfig(property.Adult_Child_Config.Airbnb) }}</span>
                </div>
                <!-- <div class="config-item" *ngIf="property.Adult_Child_Config?.VRBO">
                  <i class="fas fa-home text-warning"></i>
                  <span class="config-text">Max guests: {{ formatGuestConfig(property.Adult_Child_Config.VRBO) }}</span>
                </div> -->
                <div class="no-config-text" *ngIf="!property.Adult_Child_Config?.Booking && !property.Adult_Child_Config?.Airbnb && !property.Adult_Child_Config?.VRBO">
                  <small class="text-muted" style="font-size: var(--font-size-xs);">No configuration</small>
                </div>
              </div>
            </td>
            <td *ngIf="columnVisibility.pickupOcc">
              <div class="pickup-occ-cell">
                <div class="pickup-item" *ngIf="property.Pick_Up_Occ && property.Pick_Up_Occ['7_Days'] !== null && property.Pick_Up_Occ['7_Days'] !== undefined">
                  <span class="pickup-label">7D:</span>
                  <span class="pickup-value">{{ property.Pick_Up_Occ['7_Days'] }}</span>
                </div>
                <div class="pickup-item" *ngIf="!property.Pick_Up_Occ || property.Pick_Up_Occ['7_Days'] === null || property.Pick_Up_Occ['7_Days'] === undefined">
                  <span class="pickup-label">7D:</span>
                  <span class="pickup-value na-value">N/A</span>
                </div>
                <div class="pickup-item" *ngIf="property.Pick_Up_Occ && property.Pick_Up_Occ['14_Days'] !== null && property.Pick_Up_Occ['14_Days'] !== undefined">
                  <span class="pickup-label">14D:</span>
                  <span class="pickup-value">{{ property.Pick_Up_Occ['14_Days'] }}</span>
                </div>
                <div class="pickup-item" *ngIf="!property.Pick_Up_Occ || property.Pick_Up_Occ['14_Days'] === null || property.Pick_Up_Occ['14_Days'] === undefined">
                  <span class="pickup-label">14D:</span>
                  <span class="pickup-value na-value">N/A</span>
                </div>
                <div class="pickup-item" *ngIf="property.Pick_Up_Occ && property.Pick_Up_Occ['30_Days'] !== null && property.Pick_Up_Occ['30_Days'] !== undefined">
                  <span class="pickup-label">30D:</span>
                  <span class="pickup-value">{{ property.Pick_Up_Occ['30_Days'] }}</span>
                </div>
                <div class="pickup-item" *ngIf="!property.Pick_Up_Occ || property.Pick_Up_Occ['30_Days'] === null || property.Pick_Up_Occ['30_Days'] === undefined">
                  <span class="pickup-label">30D:</span>
                  <span class="pickup-value na-value">N/A</span>
                </div>
              </div>
            </td>
            <td *ngIf="columnVisibility.minRateThreshold">
              <div class="min-rate-threshold-cell">
                <span class="threshold-value">{{ property.Min_Rate_Threshold || 'N/A' }}</span>
              </div>
            </td>
            <td *ngIf="columnVisibility.stlyVarOcc">
              <div class="stly-var-single-cell">
                <span class="badge" [ngClass]="getPerformanceClass(property.STLY_Var.Occ)">
                  {{ property.STLY_Var.Occ }}
                </span>
              </div>
            </td>
            <td *ngIf="columnVisibility.stlyVarRevPAR">
              <div class="stly-var-single-cell">
                <span class="badge" [ngClass]="getPerformanceClass(property.STLY_Var.RevPAR)">
                  {{ property.STLY_Var.RevPAR }}
                </span>
              </div>
            </td>
            <td *ngIf="columnVisibility.lastReviewScore">
              <div class="review-score-cell">
                <!-- Booking.com Last Review Score -->
                <div class="review-item" *ngIf="property.Reviews.Booking.Last_Rev_Score !== null" 
                  [class.clickable]="safeParseNumber(property.Reviews.Booking.Last_Rev_Score) > 0" 
                  [title]="safeParseNumber(property.Reviews.Booking.Last_Rev_Score) > 0 ? 'Click to visit Booking.com property page' : 'Booking.com: ' + property.Reviews.Booking.Last_Rev_Score"
                  (click)="safeParseNumber(property.Reviews.Booking.Last_Rev_Score) > 0 ? openPropertyUrl(property, 'Booking') : null">
                  <i class="fas fa-bed "></i>
                  <span class="score-value">{{ property.Reviews.Booking.Last_Rev_Score }}</span>
                </div>

                <!-- Airbnb Last Review Score -->
                <div class="review-item" *ngIf="property.Reviews.Airbnb.Last_Rev_Score !== null" 
                  [class.clickable]="safeParseNumber(property.Reviews.Airbnb.Last_Rev_Score) > 0" 
                  [title]="safeParseNumber(property.Reviews.Airbnb.Last_Rev_Score) > 0 ? 'Click to visit Airbnb property page' : 'Airbnb: ' + property.Reviews.Airbnb.Last_Rev_Score"
                  (click)="safeParseNumber(property.Reviews.Airbnb.Last_Rev_Score) > 0 ? openPropertyUrl(property, 'Airbnb') : null">
                  <i class="fab fa-airbnb text-danger"></i>
                  <span class="score-value">{{ property.Reviews.Airbnb.Last_Rev_Score }}</span>
                </div>

                <!-- VRBO Last Review Score -->
                <!-- <div class="review-item" *ngIf="property.Reviews.VRBO.Last_Rev_Score !== null" 
                  [class.clickable]="safeParseNumber(property.Reviews.VRBO.Last_Rev_Score) > 0" 
                  [title]="safeParseNumber(property.Reviews.VRBO.Last_Rev_Score) > 0 ? 'Click to visit VRBO property page' : 'VRBO: ' + property.Reviews.VRBO.Last_Rev_Score"
                  (click)="safeParseNumber(property.Reviews.VRBO.Last_Rev_Score) > 0 ? openPropertyUrl(property, 'VRBO') : null">
                  <i class="fas fa-home text-warning"></i>
                  <span class="score-value">{{ property.Reviews.VRBO.Last_Rev_Score }}</span>
                </div> -->
              </div>
            </td>
            <td *ngIf="columnVisibility.lastReviewDate">
              <div class="revenue-date-cell">
                <!-- Booking.com Last Review Date -->
                <div class="date-item" *ngIf="property.Reviews.Booking.Last_Review_Date !== null">
                  <i class="fas fa-bed "></i>
                  <span class="date-value">
                    <span *ngIf="property.Reviews.Booking.Last_Review_Date && property.Reviews.Booking.Last_Review_Date.trim() !== '' && property.Reviews.Booking.Last_Review_Date !== 'N/A'">
                      {{ property.Reviews.Booking.Last_Review_Date | date:'MMM dd, yyyy' }}
                    </span>
                    <span *ngIf="property.Reviews.Booking.Last_Review_Date === 'N/A' || property.Reviews.Booking.Last_Review_Date.trim() === ''">
                      {{ property.Reviews.Booking.Last_Review_Date }}
                    </span>
                  </span>
                </div>
                
                <!-- Airbnb Last Review Date -->
                <div class="date-item" *ngIf="property.Reviews.Airbnb.Last_Review_Date !== null">
                  <i class="fab fa-airbnb text-danger"></i>
                  <span class="date-value">
                    <span *ngIf="property.Reviews.Airbnb.Last_Review_Date && property.Reviews.Airbnb.Last_Review_Date.trim() !== '' && property.Reviews.Airbnb.Last_Review_Date !== 'N/A'">
                      {{ property.Reviews.Airbnb.Last_Review_Date | date:'MMM dd, yyyy' }}
                    </span>
                    <span *ngIf="property.Reviews.Airbnb.Last_Review_Date === 'N/A' || property.Reviews.Airbnb.Last_Review_Date.trim() === ''">
                      {{ property.Reviews.Airbnb.Last_Review_Date }}
                    </span>
                  </span>
                </div>
                
                <!-- VRBO Last Review Date -->
                <!-- <div class="date-item" *ngIf="property.Reviews.VRBO.Last_Review_Date !== null">
                  <i class="fas fa-home text-warning"></i>
                  <span class="date-value">
                    <span *ngIf="property.Reviews.VRBO.Last_Review_Date && property.Reviews.VRBO.Last_Review_Date.trim() !== '' && property.Reviews.VRBO.Last_Review_Date !== 'N/A'">
                      {{ property.Reviews.VRBO.Last_Review_Date | date:'MMM dd, yyyy' }}
                    </span>
                    <span *ngIf="property.Reviews.VRBO.Last_Review_Date === 'N/A' || property.Reviews.VRBO.Last_Review_Date.trim() === ''">
                      {{ property.Reviews.VRBO.Last_Review_Date }}
                    </span>
                  </span>
                </div> -->
              </div>
            </td>
            <td *ngIf="columnVisibility.actions">
              <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-primary btn-sm" (click)="viewDetails(property._id)">
                  <i class="fas fa-eye"></i>
                </button>
                <!-- <button class="btn btn-outline-info btn-sm" (click)="compareProperty(property)">
                <i class="fas fa-balance-scale"></i>
              </button> -->
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      
      <!-- Infinite Scroll Loading Indicator -->
      <div class="infinite-scroll-loading" *ngIf="isLoadingMore">
        <div class="text-center py-3">
          <div class="spinner-border spinner-border-sm" role="status">
            <span class="visually-hidden">Loading more...</span>
          </div>
          <span class="ms-2">Loading more properties...</span>
        </div>
      </div>
      
      <!-- End of Data Indicator -->
      <div class="end-of-data" *ngIf="!hasMoreData && propertyData && propertyData.length > 0 && !loading">
        <div class="text-center py-3 text-muted">
          <small>You've reached the end of the list</small>
        </div>
      </div>
    </div>
 

    <!-- Empty State -->
    <div *ngIf="!loading && !error && (!propertyData || propertyData.length === 0)" class="text-center py-5">
      <div class="card">
        <div class="card-body">
          <i class="fas fa-building fa-3x text-muted mb-3"></i>
          <h5 class="card-title">No Properties Found</h5>
          <p class="card-text">No properties found matching your criteria. Try adjusting your filters or search terms.</p>
          <button class="btn btn-primary" (click)="clearAllFilters()">
            <i class="fas fa-refresh me-2"></i>Clear Filters
          </button>
        </div>
      </div>
    </div>


    <!-- Filter Modal -->
    <div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="filterModalLabel">
              <i class="fas fa-filter me-2"></i>Filter Properties
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <!-- Filter Tabs -->
            <ul class="nav nav-tabs mb-3" id="filterTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic"
                  type="button" role="tab" aria-controls="basic" aria-selected="true">Basic</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="occupancy-tab" data-bs-toggle="tab" data-bs-target="#occupancy"
                  type="button" role="tab" aria-controls="occupancy" aria-selected="false">Occupancy</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="performance-tab" data-bs-toggle="tab" data-bs-target="#performance"
                  type="button" role="tab" aria-controls="performance" aria-selected="false">Performance</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="platforms-tab" data-bs-toggle="tab" data-bs-target="#platforms"
                  type="button" role="tab" aria-controls="platforms" aria-selected="false">Platforms</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button"
                  role="tab" aria-controls="reviews" aria-selected="false">Reviews</button>
              </li>

            </ul>

            <div class="tab-content" id="filterTabsContent">
              <!-- Basic Filters Tab -->
              <div class="tab-pane fade show active" id="basic" role="tabpanel" aria-labelledby="basic-tab">
                <div class="row">
                  <!-- Area Filter -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Area</label>
                    <select class="form-select" [(ngModel)]="tempSelectedArea">
                      <option value="">All Areas</option>
                      <option *ngFor="let area of areas" [value]="area">{{ area }}</option>
                    </select>
                  </div>

                  <!-- Room Type Filter -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Room Type</label>
                    <select class="form-select" [(ngModel)]="tempSelectedRoomType">
                      <option value="">All Types</option>
                      <option *ngFor="let type of roomTypes" [value]="type">{{ type }}</option>
                    </select>
                  </div>

                  <!-- ADR Range Filter -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">ADR Range (TM)</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">${{ tempAdrMin || adrMinRange }}</span>
                        <span class="max-value">${{ tempAdrMax || adrMaxRange }}</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" [min]="adrMinRange" [max]="adrMaxRange" [value]="tempAdrMin || adrMinRange"
                          (input)="onAdrMinChange($event)" class="range-min">
                        <input type="range" [min]="adrMinRange" [max]="adrMaxRange" [value]="tempAdrMax || adrMaxRange"
                          (input)="onAdrMaxChange($event)" class="range-max">
                      </div>
                    </div>
                  </div>

                  <!-- RevPAR Range Filter -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">RevPAR Range (TM)</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">${{ tempRevparMin || revparMinRange }}</span>
                        <span class="max-value">${{ tempRevparMax || revparMaxRange }}</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" [min]="revparMinRange" [max]="revparMaxRange"
                          [value]="tempRevparMin || revparMinRange" (input)="onRevparMinChange($event)"
                          class="range-min">
                        <input type="range" [min]="revparMinRange" [max]="revparMaxRange"
                          [value]="tempRevparMax || revparMaxRange" (input)="onRevparMaxChange($event)"
                          class="range-max">
                      </div>
                    </div>
                  </div>

                  <!-- MPI Range Filter -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">MPI Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ tempMpiMin || mpiMinRange }}%</span>
                        <span class="max-value">{{ tempMpiMax || mpiMaxRange }}%</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" [min]="mpiMinRange" [max]="mpiMaxRange" [value]="tempMpiMin || mpiMinRange"
                          (input)="onMpiMinChange($event)" class="range-min">
                        <input type="range" [min]="mpiMinRange" [max]="mpiMaxRange" [value]="tempMpiMax || mpiMaxRange"
                          (input)="onMpiMaxChange($event)" class="range-max">
                      </div>
                    </div>
                  </div>

                  <!-- Min Rate Threshold Filter -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Min Rate Threshold</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ tempMinRateThresholdMin || 0 }}%</span>
                        <span class="max-value">{{ tempMinRateThresholdMax || 100 }}%</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" min="0" max="100" [value]="tempMinRateThresholdMin || 0"
                          (input)="onMinRateThresholdMinChange($event)" class="range-min">
                        <input type="range" min="0" max="100" [value]="tempMinRateThresholdMax || 100"
                          (input)="onMinRateThresholdMaxChange($event)" class="range-max">
                      </div>
                    </div>
                  </div>

                </div>
              </div>

              <!-- Occupancy Filters Tab -->
              <div class="tab-pane fade" id="occupancy" role="tabpanel" aria-labelledby="occupancy-tab">
                <div class="row">
                  <!-- Occupancy TM Range -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Occupancy TM Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ tempOccupancyTMMin || 0 }}%</span>
                        <span class="max-value">{{ tempOccupancyTMMax || 100 }}%</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" min="0" max="100" [value]="tempOccupancyTMMin || 0"
                          (input)="onOccupancyTMMinChange($event)" class="range-min">
                        <input type="range" min="0" max="100" [value]="tempOccupancyTMMax || 100"
                          (input)="onOccupancyTMMaxChange($event)" class="range-max">
                      </div>
                    </div>
                  </div>

                  <!-- Occupancy NM Range -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Occupancy NM Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ occupancyNMMin || 0 }}%</span>
                        <span class="max-value">{{ occupancyNMMax || 100 }}%</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" min="0" max="100" [value]="occupancyNMMin || 0"
                          (input)="onOccupancyNMMinChange($event)" class="range-min">
                        <input type="range" min="0" max="100" [value]="occupancyNMMax || 100"
                          (input)="onOccupancyNMMaxChange($event)" class="range-max">
                      </div>
                    </div>
                  </div>

                  <!-- Occupancy 7 Days Range -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Occupancy 7 Days Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ occupancy7DaysMin || 0 }}%</span>
                        <span class="max-value">{{ occupancy7DaysMax || 100 }}%</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" min="0" max="100" [value]="occupancy7DaysMin || 0"
                          (input)="onOccupancy7DaysMinChange($event)" class="range-min">
                        <input type="range" min="0" max="100" [value]="occupancy7DaysMax || 100"
                          (input)="onOccupancy7DaysMaxChange($event)" class="range-max">
                      </div>
                    </div>
                  </div>

                  <!-- Occupancy 30 Days Range -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Occupancy 30 Days Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ occupancy30DaysMin || 0 }}%</span>
                        <span class="max-value">{{ occupancy30DaysMax || 100 }}%</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" min="0" max="100" [value]="occupancy30DaysMin || 0"
                          (input)="onOccupancy30DaysMinChange($event)" class="range-min">
                        <input type="range" min="0" max="100" [value]="occupancy30DaysMax || 100"
                          (input)="onOccupancy30DaysMaxChange($event)" class="range-max">
                      </div>
                    </div>
                  </div>

                  <!-- Pick Up Occupancy 7 Days -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Pick Up Occ 7 Days Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ pickUpOcc7DaysMin || 0 }}%</span>
                        <span class="max-value">{{ pickUpOcc7DaysMax || 100 }}%</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" min="0" max="100" [value]="pickUpOcc7DaysMin || 0"
                          (input)="onPickUpOcc7DaysMinChange($event)" class="range-min">
                        <input type="range" min="0" max="100" [value]="pickUpOcc7DaysMax || 100"
                          (input)="onPickUpOcc7DaysMaxChange($event)" class="range-max">
                      </div>
                    </div>
                  </div>

                  <!-- Pick Up Occupancy 14 Days -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Pick Up Occ 14 Days Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ pickUpOcc14DaysMin || 0 }}%</span>
                        <span class="max-value">{{ pickUpOcc14DaysMax || 100 }}%</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" min="0" max="100" [value]="pickUpOcc14DaysMin || 0"
                          (input)="onPickUpOcc14DaysMinChange($event)" class="range-min">
                        <input type="range" min="0" max="100" [value]="pickUpOcc14DaysMax || 100"
                          (input)="onPickUpOcc14DaysMaxChange($event)" class="range-max">
                      </div>
                    </div>
                  </div>

                  <!-- Pick Up Occupancy 30 Days -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Pick Up Occ 30 Days Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ pickUpOcc30DaysMin || 0 }}%</span>
                        <span class="max-value">{{ pickUpOcc30DaysMax || 100 }}%</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" min="0" max="100" [value]="pickUpOcc30DaysMin || 0"
                          (input)="onPickUpOcc30DaysMinChange($event)" class="range-min">
                        <input type="range" min="0" max="100" [value]="pickUpOcc30DaysMax || 100"
                          (input)="onPickUpOcc30DaysMaxChange($event)" class="range-max">
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Performance Filters Tab -->
              <div class="tab-pane fade" id="performance" role="tabpanel" aria-labelledby="performance-tab">
                <div class="row">
                  <!-- STLY Var Occupancy -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">STLY Var Occupancy Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ stlyVarOccMin || stlyVarOccMinRange }}%</span>
                        <span class="max-value">{{ stlyVarOccMax || stlyVarOccMaxRange }}%</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" [min]="stlyVarOccMinRange" [max]="stlyVarOccMaxRange"
                          [value]="stlyVarOccMin || stlyVarOccMinRange" (input)="onStlyVarOccMinChange($event)"
                          class="range-min">
                        <input type="range" [min]="stlyVarOccMinRange" [max]="stlyVarOccMaxRange"
                          [value]="stlyVarOccMax || stlyVarOccMaxRange" (input)="onStlyVarOccMaxChange($event)"
                          class="range-max">
                      </div>
                    </div>
                  </div>

                  <!-- STLY Var ADR -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">STLY Var ADR Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ stlyVarADRMin || stlyVarADRMinRange }}%</span>
                        <span class="max-value">{{ stlyVarADRMax || stlyVarADRMaxRange }}%</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" [min]="stlyVarADRMinRange" [max]="stlyVarADRMaxRange"
                          [value]="stlyVarADRMin || stlyVarADRMinRange" (input)="onStlyVarADRMinChange($event)"
                          class="range-min">
                        <input type="range" [min]="stlyVarADRMinRange" [max]="stlyVarADRMaxRange"
                          [value]="stlyVarADRMax || stlyVarADRMaxRange" (input)="onStlyVarADRMaxChange($event)"
                          class="range-max">
                      </div>
                    </div>
                  </div>

                  <!-- STLY Var RevPAR -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">STLY Var RevPAR Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ stlyVarRevPARMin || stlyVarRevPARMinRange }}%</span>
                        <span class="max-value">{{ stlyVarRevPARMax || stlyVarRevPARMaxRange }}%</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" [min]="stlyVarRevPARMinRange" [max]="stlyVarRevPARMaxRange"
                          [value]="stlyVarRevPARMin || stlyVarRevPARMinRange" (input)="onStlyVarRevPARMinChange($event)"
                          class="range-min">
                        <input type="range" [min]="stlyVarRevPARMinRange" [max]="stlyVarRevPARMaxRange"
                          [value]="stlyVarRevPARMax || stlyVarRevPARMaxRange" (input)="onStlyVarRevPARMaxChange($event)"
                          class="range-max">
                      </div>
                    </div>
                  </div>

                  <!-- STLM Var Occupancy -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">STLM Var Occupancy Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ stlmVarOccMin || stlmVarOccMinRange }}%</span>
                        <span class="max-value">{{ stlmVarOccMax || stlmVarOccMaxRange }}%</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" [min]="stlmVarOccMinRange" [max]="stlmVarOccMaxRange"
                          [value]="stlmVarOccMin || stlmVarOccMinRange" (input)="onStlmVarOccMinChange($event)"
                          class="range-min">
                        <input type="range" [min]="stlmVarOccMinRange" [max]="stlmVarOccMaxRange"
                          [value]="stlmVarOccMax || stlmVarOccMaxRange" (input)="onStlmVarOccMaxChange($event)"
                          class="range-max">
                      </div>
                    </div>
                  </div>

                  <!-- STLM Var ADR -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">STLM Var ADR Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ stlmVarADRMin || stlmVarADRMinRange }}%</span>
                        <span class="max-value">{{ stlmVarADRMax || stlmVarADRMaxRange }}%</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" [min]="stlmVarADRMinRange" [max]="stlmVarADRMaxRange"
                          [value]="stlmVarADRMin || stlmVarADRMinRange" (input)="onStlmVarADRMinChange($event)"
                          class="range-min">
                        <input type="range" [min]="stlmVarADRMinRange" [max]="stlmVarADRMaxRange"
                          [value]="stlmVarADRMax || stlmVarADRMaxRange" (input)="onStlmVarADRMaxChange($event)"
                          class="range-max">
                      </div>
                    </div>
                  </div>

                  <!-- STLM Var RevPAR -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label">STLM Var RevPAR Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ stlmVarRevPARMin || stlmVarRevPARMinRange }}%</span>
                        <span class="max-value">{{ stlmVarRevPARMax || stlmVarRevPARMaxRange }}%</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" [min]="stlmVarRevPARMinRange" [max]="stlmVarRevPARMaxRange"
                          [value]="stlmVarRevPARMin || stlmVarRevPARMinRange" (input)="onStlmVarRevPARMinChange($event)"
                          class="range-min">
                        <input type="range" [min]="stlmVarRevPARMinRange" [max]="stlmVarRevPARMaxRange"
                          [value]="stlmVarRevPARMax || stlmVarRevPARMaxRange" (input)="onStlmVarRevPARMaxChange($event)"
                          class="range-max">
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Platform Filters Tab -->
              <div class="tab-pane fade" id="platforms" role="tabpanel" aria-labelledby="platforms-tab">
                <div class="row">
                  <!-- Booking.com Filters -->
                  <div class="col-12 mb-3">
                    <h6 class="fw-bold ">Booking.com Features</h6>
                  </div>
                  <div class="col-md-4 mb-3">
                    <div class="slider-container">
                      <label class="slider-label">Genius Program</label>
                      <div class="three-point-slider"
                        (click)="onThreePointSliderChange('bookingGenius', getNextSliderValue(tempBookingGeniusFilter))">
                        <div class="slider-track"></div>
                        <div class="slider-thumb" [class]="tempBookingGeniusFilter">
                          {{ getSliderDisplayValue(tempBookingGeniusFilter) }}
                        </div>
                        <div class="slider-labels">
                          <span class="label not-present" [class.active]="tempBookingGeniusFilter === 'not-present'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingGenius', 'not-present')"></span>
                          <span class="label no" [class.active]="tempBookingGeniusFilter === 'no'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingGenius', 'no')"></span>
                          <span class="label yes" [class.active]="tempBookingGeniusFilter === 'yes'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingGenius', 'yes')"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <div class="slider-container">
                      <label class="slider-label">Mobile Deals</label>
                      <div class="three-point-slider"
                        (click)="onThreePointSliderChange('bookingMobile', getNextSliderValue(tempBookingMobileFilter))">
                        <div class="slider-track"></div>
                        <div class="slider-thumb" [class]="tempBookingMobileFilter">{{
                          getSliderDisplayValue(tempBookingMobileFilter) }}</div>
                        <div class="slider-labels">
                          <span class="label not-present" [class.active]="tempBookingMobileFilter === 'not-present'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingMobile', 'not-present')"></span>
                          <span class="label no" [class.active]="tempBookingMobileFilter === 'no'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingMobile', 'no')"></span>
                          <span class="label yes" [class.active]="tempBookingMobileFilter === 'yes'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingMobile', 'yes')"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <div class="slider-container">
                      <label class="slider-label">Preferred Partner</label>
                      <div class="three-point-slider"
                        (click)="onThreePointSliderChange('bookingPref', getNextSliderValue(tempBookingPrefFilter))">
                        <div class="slider-track"></div>
                        <div class="slider-thumb" [class]="tempBookingPrefFilter">{{
                          getSliderDisplayValue(tempBookingPrefFilter) }}</div>
                        <div class="slider-labels">
                          <span class="label not-present" [class.active]="tempBookingPrefFilter === 'not-present'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingPref', 'not-present')"></span>
                          <span class="label no" [class.active]="tempBookingPrefFilter === 'no'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingPref', 'no')"></span>
                          <span class="label yes" [class.active]="tempBookingPrefFilter === 'yes'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingPref', 'yes')"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <div class="slider-container">
                      <label class="slider-label">Weekly Discounts</label>
                      <div class="three-point-slider"
                        (click)="onThreePointSliderChange('bookingWeekly', getNextSliderValue(tempBookingWeeklyFilter))">
                        <div class="slider-track"></div>
                        <div class="slider-thumb" [class]="tempBookingWeeklyFilter">{{
                          getSliderDisplayValue(tempBookingWeeklyFilter) }}</div>
                        <div class="slider-labels">
                          <span class="label not-present" [class.active]="tempBookingWeeklyFilter === 'not-present'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingWeekly', 'not-present')"></span>
                          <span class="label no" [class.active]="tempBookingWeeklyFilter === 'no'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingWeekly', 'no')"></span>
                          <span class="label yes" [class.active]="tempBookingWeeklyFilter === 'yes'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingWeekly', 'yes')"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <div class="slider-container">
                      <label class="slider-label">Monthly Discounts</label>
                      <div class="three-point-slider"
                        (click)="onThreePointSliderChange('bookingMonthly', getNextSliderValue(tempBookingMonthlyFilter))">
                        <div class="slider-track"></div>
                        <div class="slider-thumb" [class]="tempBookingMonthlyFilter">{{
                          getSliderDisplayValue(tempBookingMonthlyFilter) }}</div>
                        <div class="slider-labels">
                          <span class="label not-present" [class.active]="tempBookingMonthlyFilter === 'not-present'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingMonthly', 'not-present')"></span>
                          <span class="label no" [class.active]="tempBookingMonthlyFilter === 'no'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingMonthly', 'no')"></span>
                          <span class="label yes" [class.active]="tempBookingMonthlyFilter === 'yes'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingMonthly', 'yes')"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <div class="slider-container">
                      <label class="slider-label">Last Minute Discount</label>
                      <div class="three-point-slider"
                        (click)="onThreePointSliderChange('bookingLMDisc', getNextSliderValue(tempBookingLMDiscFilter))">
                        <div class="slider-track"></div>
                        <div class="slider-thumb" [class]="tempBookingLMDiscFilter">{{
                          getSliderDisplayValue(tempBookingLMDiscFilter) }}</div>
                        <div class="slider-labels">
                          <span class="label not-present" [class.active]="tempBookingLMDiscFilter === 'not-present'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingLMDisc', 'not-present')"></span>
                          <span class="label no" [class.active]="tempBookingLMDiscFilter === 'no'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingLMDisc', 'no')"></span>
                          <span class="label yes" [class.active]="tempBookingLMDiscFilter === 'yes'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('bookingLMDisc', 'yes')"></span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Airbnb Filters -->
                  <div class="col-12 mb-3 mt-4">
                    <h6 class="fw-bold text-danger">Airbnb Features</h6>
                  </div>
                  <div class="col-md-3 mb-3">
                    <div class="slider-container">
                      <label class="slider-label">Weekly Discounts</label>
                      <div class="three-point-slider"
                        (click)="onThreePointSliderChange('airbnbWeekly', getNextSliderValue(tempAirbnbWeeklyFilter))">
                        <div class="slider-track"></div>
                        <div class="slider-thumb" [class]="tempAirbnbWeeklyFilter">{{
                          getSliderDisplayValue(tempAirbnbWeeklyFilter) }}</div>
                        <div class="slider-labels">
                          <span class="label not-present" [class.active]="tempAirbnbWeeklyFilter === 'not-present'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('airbnbWeekly', 'not-present')"></span>
                          <span class="label no" [class.active]="tempAirbnbWeeklyFilter === 'no'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('airbnbWeekly', 'no')"></span>
                          <span class="label yes" [class.active]="tempAirbnbWeeklyFilter === 'yes'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('airbnbWeekly', 'yes')"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3 mb-3">
                    <div class="slider-container">
                      <label class="slider-label">Monthly Discounts</label>
                      <div class="three-point-slider"
                        (click)="onThreePointSliderChange('airbnbMonthly', getNextSliderValue(tempAirbnbMonthlyFilter))">
                        <div class="slider-track"></div>
                        <div class="slider-thumb" [class]="tempAirbnbMonthlyFilter">{{
                          getSliderDisplayValue(tempAirbnbMonthlyFilter) }}</div>
                        <div class="slider-labels">
                          <span class="label not-present" [class.active]="tempAirbnbMonthlyFilter === 'not-present'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('airbnbMonthly', 'not-present')"></span>
                          <span class="label no" [class.active]="tempAirbnbMonthlyFilter === 'no'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('airbnbMonthly', 'no')"></span>
                          <span class="label yes" [class.active]="tempAirbnbMonthlyFilter === 'yes'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('airbnbMonthly', 'yes')"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3 mb-3">
                    <div class="slider-container">
                      <label class="slider-label">Member Discount</label>
                      <div class="three-point-slider"
                        (click)="onThreePointSliderChange('airbnbMember', getNextSliderValue(tempAirbnbMemberFilter))">
                        <div class="slider-track"></div>
                        <div class="slider-thumb" [class]="tempAirbnbMemberFilter">{{
                          getSliderDisplayValue(tempAirbnbMemberFilter) }}</div>
                        <div class="slider-labels">
                          <span class="label not-present" [class.active]="tempAirbnbMemberFilter === 'not-present'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('airbnbMember', 'not-present')"></span>
                          <span class="label no" [class.active]="tempAirbnbMemberFilter === 'no'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('airbnbMember', 'no')"></span>
                          <span class="label yes" [class.active]="tempAirbnbMemberFilter === 'yes'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('airbnbMember', 'yes')"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3 mb-3">
                    <div class="slider-container">
                      <label class="slider-label">Last Minute Discount</label>
                      <div class="three-point-slider"
                        (click)="onThreePointSliderChange('airbnbLMDisc', getNextSliderValue(tempAirbnbLMDiscFilter))">
                        <div class="slider-track"></div>
                        <div class="slider-thumb" [class]="tempAirbnbLMDiscFilter">{{
                          getSliderDisplayValue(tempAirbnbLMDiscFilter) }}</div>
                        <div class="slider-labels">
                          <span class="label not-present" [class.active]="tempAirbnbLMDiscFilter === 'not-present'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('airbnbLMDisc', 'not-present')"></span>
                          <span class="label no" [class.active]="tempAirbnbLMDiscFilter === 'no'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('airbnbLMDisc', 'no')"></span>
                          <span class="label yes" [class.active]="tempAirbnbLMDiscFilter === 'yes'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('airbnbLMDisc', 'yes')"></span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- VRBO Filters -->
                  <!-- <div class="col-12 mb-3 mt-4">
                    <h6 class="fw-bold text-warning">VRBO Features</h6>
                  </div>
                  <div class="col-md-6 mb-3">
                    <div class="slider-container">
                      <label class="slider-label">Weekly Discounts</label>
                      <div class="three-point-slider"
                        (click)="onThreePointSliderChange('vrboWeekly', getNextSliderValue(tempVrboWeeklyFilter))">
                        <div class="slider-track"></div>
                        <div class="slider-thumb" [class]="tempVrboWeeklyFilter">{{
                          getSliderDisplayValue(tempVrboWeeklyFilter) }}</div>
                        <div class="slider-labels">
                          <span class="label not-present" [class.active]="tempVrboWeeklyFilter === 'not-present'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('vrboWeekly', 'not-present')"></span>
                          <span class="label no" [class.active]="tempVrboWeeklyFilter === 'no'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('vrboWeekly', 'no')"></span>
                          <span class="label yes" [class.active]="tempVrboWeeklyFilter === 'yes'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('vrboWeekly', 'yes')"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <div class="slider-container">
                      <label class="slider-label">Monthly Discounts</label>
                      <div class="three-point-slider"
                        (click)="onThreePointSliderChange('vrboMonthly', getNextSliderValue(tempVrboMonthlyFilter))">
                        <div class="slider-track"></div>
                        <div class="slider-thumb" [class]="tempVrboMonthlyFilter">{{
                          getSliderDisplayValue(tempVrboMonthlyFilter) }}</div>
                        <div class="slider-labels">
                          <span class="label not-present" [class.active]="tempVrboMonthlyFilter === 'not-present'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('vrboMonthly', 'not-present')"></span>
                          <span class="label no" [class.active]="tempVrboMonthlyFilter === 'no'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('vrboMonthly', 'no')"></span>
                          <span class="label yes" [class.active]="tempVrboMonthlyFilter === 'yes'"
                            (click)="$event.stopPropagation(); onThreePointSliderChange('vrboMonthly', 'yes')"></span>
                        </div>
                      </div>
                    </div>
                  </div> -->
                </div>
              </div>

              <!-- Reviews Filters Tab -->
              <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                <div class="row">
                  <!-- Booking Reviews -->
                  <div class="col-12 mb-3">
                    <h6 class="fw-bold ">Booking.com Reviews</h6>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Review Score Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ tempBookingRevScoreMin || 0 }}</span>
                        <span class="max-value">{{ tempBookingRevScoreMax || 10 }}</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" min="0" max="10" step="0.1" [value]="tempBookingRevScoreMin || 0"
                          (input)="onBookingRevScoreMinChange($event)" class="range-min">
                        <input type="range" min="0" max="10" step="0.1" [value]="tempBookingRevScoreMax || 10"
                          (input)="onBookingRevScoreMaxChange($event)" class="range-max">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Total Reviews Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ tempBookingTotalRevMin || bookingTotalRevMinRange }}</span>
                        <span class="max-value">{{ tempBookingTotalRevMax || bookingTotalRevMaxRange }}</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" [min]="bookingTotalRevMinRange" [max]="bookingTotalRevMaxRange"
                          [value]="tempBookingTotalRevMin || bookingTotalRevMinRange"
                          (input)="onBookingTotalRevMinChange($event)" class="range-min">
                        <input type="range" [min]="bookingTotalRevMinRange" [max]="bookingTotalRevMaxRange"
                          [value]="tempBookingTotalRevMax || bookingTotalRevMaxRange"
                          (input)="onBookingTotalRevMaxChange($event)" class="range-max">
                      </div>
                    </div>
                  </div>

                  <!-- Airbnb Reviews -->
                  <div class="col-12 mb-3 mt-4">
                    <h6 class="fw-bold text-danger">Airbnb Reviews</h6>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Review Score Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ tempAirbnbRevScoreMin || 0 }}</span>
                        <span class="max-value">{{ tempAirbnbRevScoreMax || 5 }}</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" min="0" max="5" step="0.1" [value]="tempAirbnbRevScoreMin || 0"
                          (input)="onAirbnbRevScoreMinChange($event)" class="range-min">
                        <input type="range" min="0" max="5" step="0.1" [value]="tempAirbnbRevScoreMax || 5"
                          (input)="onAirbnbRevScoreMaxChange($event)" class="range-max">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Total Reviews Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ tempAirbnbTotalRevMin || airbnbTotalRevMinRange }}</span>
                        <span class="max-value">{{ tempAirbnbTotalRevMax || airbnbTotalRevMaxRange }}</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" [min]="airbnbTotalRevMinRange" [max]="airbnbTotalRevMaxRange"
                          [value]="tempAirbnbTotalRevMin || airbnbTotalRevMinRange"
                          (input)="onAirbnbTotalRevMinChange($event)" class="range-min">
                        <input type="range" [min]="airbnbTotalRevMinRange" [max]="airbnbTotalRevMaxRange"
                          [value]="tempAirbnbTotalRevMax || airbnbTotalRevMaxRange"
                          (input)="onAirbnbTotalRevMaxChange($event)" class="range-max">
                      </div>
                    </div>
                  </div>

                  <!-- VRBO Reviews -->
                  <!-- <div class="col-12 mb-3 mt-4">
                    <h6 class="fw-bold text-warning">VRBO Reviews</h6>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Review Score Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ tempVrboRevScoreMin || 0 }}</span>
                        <span class="max-value">{{ tempVrboRevScoreMax || 5 }}</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" min="0" max="5" step="0.1" [value]="tempVrboRevScoreMin || 0"
                          (input)="onVrboRevScoreMinChange($event)" class="range-min">
                        <input type="range" min="0" max="5" step="0.1" [value]="tempVrboRevScoreMax || 5"
                          (input)="onVrboRevScoreMaxChange($event)" class="range-max">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Total Reviews Range</label>
                    <div class="range-slider-container">
                      <div class="range-values">
                        <span class="min-value">{{ tempVrboTotalRevMin || vrboTotalRevMinRange }}</span>
                        <span class="max-value">{{ tempVrboTotalRevMax || vrboTotalRevMaxRange }}</span>
                      </div>
                      <div class="dual-range-slider">
                        <input type="range" [min]="vrboTotalRevMinRange" [max]="vrboTotalRevMaxRange"
                          [value]="tempVrboTotalRevMin || vrboTotalRevMinRange"
                          (input)="onVrboTotalRevMinChange($event)" class="range-min">
                        <input type="range" [min]="vrboTotalRevMinRange" [max]="vrboTotalRevMaxRange"
                          [value]="tempVrboTotalRevMax || vrboTotalRevMaxRange"
                          (input)="onVrboTotalRevMaxChange($event)" class="range-max">
                      </div>
                    </div>
                  </div> -->
                </div>
              </div>

            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" (click)="clearAllFilters()">
              <i class="fas fa-times me-2"></i>Clear All
            </button>
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal" (click)="applyFilters()">
              <i class="fas fa-check me-2"></i>Apply Filters
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Save Preset Modal -->
    <div class="modal fade" id="savePresetModal" tabindex="-1" aria-labelledby="savePresetModalLabel" aria-hidden="true"
      [class.show]="showSavePresetForm" [style.display]="showSavePresetForm ? 'block' : 'none'">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="savePresetModalLabel">
              <i class="fas fa-bookmark me-2"></i>Save Filter Preset
            </h5>
            <button type="button" class="btn-close" (click)="cancelSavePreset()" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form (ngSubmit)="saveCurrentFiltersAsPreset()" #presetForm="ngForm">
              <div class="mb-3">
                <label for="presetName" class="form-label">Preset Name *</label>
                <input type="text" class="form-control" id="presetName" [(ngModel)]="newPresetName" 
                  name="presetName" required maxlength="50" placeholder="Enter a name for this preset">
              </div>
              <div class="mb-3">
                <label for="presetDescription" class="form-label">Description (Optional)</label>
                <textarea class="form-control" id="presetDescription" [(ngModel)]="newPresetDescription" 
                  name="presetDescription" rows="3" maxlength="200" 
                  placeholder="Add a description to help you remember what this preset is for"></textarea>
              </div>
              
              <!-- Current Filters Preview -->
              <div class="mb-3">
                <label class="form-label">Current Selection to Save:</label>
                <div class="current-filters-preview">
                  <div class="filters-badges">
                    <!-- Show active filters if any -->
                    <span *ngFor="let filter of getAppliedFilters().slice(0, 5)" 
                      class="filter-badge filter-preview">
                      {{ filter.label }}: {{ filter.value }}
                    </span>
                    <span *ngIf="getAppliedFilters().length > 5" class="filter-badge filter-preview">
                      +{{ getAppliedFilters().length - 5 }} more filters
                    </span>
                    
                    <!-- Show property selection info -->
                    <span *ngIf="getCurrentPropertyIds().length > 0" class="filter-badge filter-preview">
                      {{ getCurrentPropertyIds().length }} selected properties
                    </span>
                    
                    <!-- Show message if neither filters nor properties are selected -->
                    <span *ngIf="getAppliedFilters().length === 0 && getCurrentPropertyIds().length === 0" 
                      class="filter-badge filter-preview text-warning">
                      No filters or properties selected
                    </span>
                  </div>
                </div>
              </div>
              
              <div *ngIf="presetSaveError" class="alert alert-danger">
                {{ presetSaveError }}
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="cancelSavePreset()">Cancel</button>
            <button type="button" class="btn btn-success" (click)="saveCurrentFiltersAsPreset()" 
              [disabled]="!newPresetName.trim() || presetSaving || (getAppliedFilters().length === 0 && getCurrentPropertyIds().length === 0)">
              <i *ngIf="!presetSaving" class="fas fa-save me-2"></i>
              <i *ngIf="presetSaving" class="fas fa-spinner fa-spin me-2"></i>Save Preset
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Preset Management Modal -->
    <div class="modal fade" id="presetManagementModal" tabindex="-1" aria-labelledby="presetManagementModalLabel" aria-hidden="true"
      [class.show]="showPresetManagement" [style.display]="showPresetManagement ? 'block' : 'none'">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="presetManagementModalLabel">
              <i class="fas fa-cog me-2"></i>Manage Filter Presets
            </h5>
            <button type="button" class="btn-close" (click)="togglePresetManagement()" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row mb-3">
              <div class="col-md-6">
                <h6>Total Presets: {{ filterPresets.length }}</h6>
              </div>
              <div class="col-md-6 text-end">
                <div class="btn-group btn-group-sm">
                  <button class="btn btn-outline-primary" (click)="exportPresets()" 
                    [disabled]="presetExporting" title="Export all presets">
                    <i *ngIf="!presetExporting" class="fas fa-download me-1"></i>
                    <i *ngIf="presetExporting" class="fas fa-spinner fa-spin me-1"></i>Export
                  </button>
                  <label class="btn btn-outline-secondary" [class.disabled]="presetImporting" title="Import presets">
                    <i *ngIf="!presetImporting" class="fas fa-upload me-1"></i>
                    <i *ngIf="presetImporting" class="fas fa-spinner fa-spin me-1"></i>Import
                    <input type="file" accept=".json" (change)="importPresets($event)" 
                      [disabled]="presetImporting" style="display: none;">
                  </label>
                </div>
              </div>
            </div>
            
            <div *ngIf="filterPresets.length === 0" class="text-center py-4 text-muted">
              <i class="fas fa-bookmark fa-3x mb-3"></i>
              <p>No filter presets saved yet.</p>
              <p>Apply some filters and click "Save as Preset" to get started!</p>
            </div>
            
            <div *ngIf="filterPresets.length > 0" class="preset-management-list">
              <div *ngFor="let preset of filterPresets" class="preset-management-item">
                <div class="preset-card">
                  <div class="preset-header">
                    <div class="preset-title">
                      <div class="d-flex align-items-center">
                        <h6 class="mb-1 me-2">{{ preset.name }}</h6>
                        <span *ngIf="selectedPresetId === preset.id" class="badge bg-success">Selected</span>
                      </div>
                      <small class="text-muted">
                        Created: {{ getSafeDate(preset.createdAt) | date:'short' }}
                        <span *ngIf="isValidDate(preset.updatedAt) && preset.updatedAt > preset.createdAt">
                          | Updated: {{ getSafeDate(preset.updatedAt) | date:'short' }}
                        </span>
                      </small>
                    </div>
                    <div class="preset-actions">
                      <button *ngIf="selectedPresetId !== preset.id" class="btn btn-sm btn-outline-primary me-1" 
                        (click)="selectedPresetId = preset.id; onPresetSelectionChange(); togglePresetManagement()"
                        title="Apply this preset">
                        <i class="fas fa-play"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-secondary me-1" 
                        (click)="duplicatePreset(preset.id)" [disabled]="presetDuplicating" title="Duplicate preset">
                        <i *ngIf="!presetDuplicating" class="fas fa-copy"></i>
                        <i *ngIf="presetDuplicating" class="fas fa-spinner fa-spin"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger" 
                        (click)="deletePreset(preset.id)" [disabled]="presetDeleting" title="Delete preset">
                        <i *ngIf="!presetDeleting" class="fas fa-trash"></i>
                        <i *ngIf="presetDeleting" class="fas fa-spinner fa-spin"></i>
                      </button>
                    </div>
                  </div>
                  <div *ngIf="preset.description" class="preset-description">
                    <small class="text-muted">{{ preset.description }}</small>
                  </div>
                  <div class="preset-summary">
                    <div class="filters-summary">
                      <span *ngFor="let summary of getPresetSummary(preset)" 
                        class="badge bg-light text-dark me-1 mb-1">{{ summary }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="togglePresetManagement()">Close</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Modal backdrop for custom modals -->
    <div class="modal-backdrop fade" 
      [class.show]="showSavePresetForm || showPresetManagement" 
      *ngIf="showSavePresetForm || showPresetManagement"
      (click)="showSavePresetForm ? cancelSavePreset() : togglePresetManagement()">
    </div>
  </div>