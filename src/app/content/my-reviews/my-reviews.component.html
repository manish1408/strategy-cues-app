<div class="my-reviews">
  <!-- Full Page Loading State -->
  <div *ngIf="loading" class="d-flex justify-content-center align-items-center" style="min-height: 60vh;">
    <div class="text-center loading-state">
      <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
        <span class="visually-hidden">Loading...</span>
      </div>
      <h4 class="text-muted">Loading Guest Insights</h4>
      <p class="text-muted">Analyzing competitor reviews and guest feedback...</p>
      <!-- <div class="progress mt-3" style="width: 300px;">
        <div class="progress-bar" role="progressbar" [style.width.%]="getLoadingProgress()" 
             [attr.aria-valuenow]="getLoadingProgress()" aria-valuemin="0" aria-valuemax="100">
          {{ getLoadingProgress() }}%
        </div>
      </div> -->
    </div>
  </div>
  <!-- Main Content (hidden while loading) -->
  <div *ngIf="!loading" class="main-content">
    <!-- Comprehensive Empty State when all data is empty -->
    <app-empty-state 
      *ngIf="isAllDataEmpty"
      icon="fas fa-comments"
      title="No Guest Review Analysis Available">
    </app-empty-state>

    <!-- Individual sections when data is available -->
    <div *ngIf="!isAllDataEmpty">
      <!-- My Reviews Analysis -->
      <div class="reviews-section">
        <div class="section-header">
          <h2>What guests didn't like about my properties</h2>
        </div>
        <div class="cards-grid" *ngIf="guestDidntLikeData && guestDidntLikeData.length > 0">
          <div class="review-card dislike-card" *ngFor="let item of guestDidntLikeData">
            <div class="card-icon">
              <i class="fas fa-times-circle"></i>
            </div>
            <div class="card-content">
              <h3 class="clickable-title" (click)="openDescriptionModal(item)">{{ item.title }}</h3>
            </div>
          </div>
        </div>
        <app-empty-state 
          *ngIf="!guestDidntLikeData || guestDidntLikeData.length === 0"
          icon="fas fa-thumbs-down"
          title="No Guest Dislikes Data Available">
        </app-empty-state>
      </div>

      <div class="reviews-section">
        <div class="section-header">
          <h2>What guests wish they had from my properties</h2>
        </div>
        <div class="cards-grid" *ngIf="guestWishesData && guestWishesData.length > 0">
          <div class="review-card wish-card" *ngFor="let item of guestWishesData">
            <div class="card-icon">
              <i class="fas fa-star"></i>
            </div>
            <div class="card-content">
              <h3 class="clickable-title" (click)="openDescriptionModal(item)">{{ item.title }}</h3>
            </div>
          </div>
        </div>
        <app-empty-state 
          *ngIf="!guestWishesData || guestWishesData.length === 0"
          icon="fas fa-wishlist"
          title="No Guest Wishes Data Available">
        </app-empty-state>
      </div>

      <div class="reviews-section">
        <div class="section-header">
          <h2>What guests love about my properties</h2>
        </div>
        <div class="cards-grid" *ngIf="guestLovedData && guestLovedData.length > 0">
          <div class="review-card love-card" *ngFor="let item of guestLovedData">
            <div class="card-icon">
              <i class="fas fa-heart"></i>
            </div>
            <div class="card-content">
              <h3 class="text-black clickable-title" (click)="openDescriptionModal(item)">{{ item.title }}</h3>
            </div>
          </div>
        </div>
        <app-empty-state 
          *ngIf="!guestLovedData || guestLovedData.length === 0"
          icon="fas fa-heart"
          title="No Guest Love Data Available">
        </app-empty-state>
      </div>

      <div class="reviews-section improvement-section">
        <div class="section-header">
          <h2>Based on my reviews, what can I improve?</h2>
        </div>
        <!-- <div class="improvement-input-container" *ngIf="whatToImproveData && whatToImproveData.length > 0">
          <div class="improvement-input">
            <textarea 
              placeholder="Share your thoughts on what you can improve based on your guest reviews..."
              class="improvement-textarea"
              rows="4">
            </textarea>
            <div class="input-footer">
              <div class="help-tooltip">
                <i class="fas fa-question-circle"></i>
                <span class="tooltip-text">Use this space to note actionable insights from your guests' reviews</span>
              </div>
            </div>
          </div>
        </div> -->
        <div class="cards-grid" *ngIf="whatToImproveData && whatToImproveData.length > 0">
          <div class="review-card action-card" *ngFor="let item of whatToImproveData">
            <div class="card-icon">
              <i class="fas fa-arrow-up"></i>
            </div>
            <div class="card-content">
              <h3 class="clickable-title" (click)="openDescriptionModal(item)">{{ item.title }}</h3>
            </div>
          </div>
        </div>
        <app-empty-state 
          *ngIf="!whatToImproveData || whatToImproveData.length === 0"
          icon="fas fa-tools"
          title="No Improvement Suggestions Available">
        </app-empty-state>
      </div>
    </div><!-- End of individual sections -->

  <!-- Help Button -->
  <div class="help-button">
    <button class="help-btn" title="Help">
      <i class="fas fa-question"></i>
    </button>
  </div>
</div>

<!-- Description Modal -->
<div class="modal fade" id="descriptionModal" tabindex="-1" aria-labelledby="descriptionModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="descriptionModalLabel">{{ selectedItem?.title }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="description-text">{{ selectedItem?.description || 'No description available.' }}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
</div>
