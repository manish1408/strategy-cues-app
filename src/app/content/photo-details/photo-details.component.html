<div class="photo-details-container">
  <!-- Header Section -->
  <div class="details-header">
    <div class="container-fluid">
      <div class="row align-items-center">
        <div class="col-md-8">
          <div class="property-title">
            <button class="btn btn-outline-secondary me-3" (click)="goBack()"> 
              <i class="fas fa-arrow-left"></i> Back to Content
            </button>
            <div class="title-info">
              <h1 class="mb-1 text-truncate" [title]="propertyData?.propertyName">{{ propertyData?.propertyName }}</h1>
              <div class="property-meta">
                <!-- <span class="badge bg-light text-dark me-2">{{ propertyData?.listing_id }}</span> -->
                <span class="badge bg-primary" *ngIf="propertyData?.num_photos"> 
                  {{ propertyData?.num_photos }} Photos
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4 text-end">
          <div class="key-metrics">
            <div class="metric" *ngIf="propertyData?.captioned_count !== null">
              <span class="metric-label">Captioned</span>
              <span class="metric-value">{{ propertyData?.captioned_count }}/{{ propertyData?.num_photos }}</span>
            </div>
            <div class="metric" *ngIf="propertyData?.missing_captions !== null">
              <span class="metric-label">Missing</span>
              <span class="metric-value">{{ propertyData?.missing_captions }}</span>
            </div>
          </div>
          <div class="booking-buttons mt-3">
            <button 
              class="btn btn-airbnb me-2" 
              (click)="openBookingLink('Airbnb')"
              [disabled]="!propertyData?.airbnb_link"
              title="View on Airbnb">
              <i class="fab fa-airbnb"></i> Airbnb
            </button>
            <button 
              class="btn btn-booking me-2" 
              (click)="openBookingLink('Booking')"
              [disabled]="!propertyData?.booking_link"
              title="View on Booking.com">
              <i class="fas fa-bed"></i> Booking.com
            </button>
            <button 
              class="btn btn-pricelab me-2" 
              (click)="openBookingLink('Pricelab')"
              [disabled]="!propertyData?.pricelabs_link"
              title="View on Pricelab">
              <i class="fas fa-chart-line"></i> Pricelab
            </button>
            <!-- <button 
              class="btn btn-vrbo" 
              (click)="openBookingLink('VRBO')"
              [disabled]="!propertyData?.vrbo_link"
              title="View on VRBO">
              <i class="fas fa-home"></i> VRBO
            </button> -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a class="nav-link" 
           [class.active]="activeTab === 'photos'"
           (click)="setActiveTab('photos')">
          Photos
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" 
           [class.active]="activeTab === 'competitor-reviews'"
           (click)="setActiveTab('competitor-reviews')">
          Competitor Reviews 
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" 
           [class.active]="activeTab === 'my-reviews'"
           (click)="setActiveTab('my-reviews')">
          My Reviews 
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" 
           [class.active]="activeTab === 'amenities'"
           (click)="setActiveTab('amenities')">
          Amenities Analyser
        </a>
      </li>
    </ul>
  </div>

  <!-- Tab Content -->
  <div class="tab-content">
    <!-- Photos Tab -->
    <div class="tab-pane" [class.active]="activeTab === 'photos'" *ngIf="activeTab === 'photos'">
      <!-- Top Navigation Cards -->
  <div class="top-navigation" *ngIf="propertyData?.competitor && propertyData.competitor.length > 0">
    <button class="nav-arrow prev" (click)="previousCompetitor()" [disabled]="selectedCompetitorIndex <= 0">
      <i class="fas fa-chevron-left"></i>
    </button>
    <div class="nav-cards" 
         (touchstart)="onTouchStart($event, 'competitor')"
         (touchmove)="onTouchMove($event)"
         (touchend)="onTouchEnd($event, 'competitor')"
         (mousedown)="onMouseDown($event, 'competitor')"
         (mousemove)="onMouseMove($event)"
         (mouseup)="onMouseUp($event, 'competitor')"
         (mouseleave)="onMouseUp($event, 'competitor')">
      <div class="nav-card" [class.active]="selectedCompetitorIndex === -1" (click)="selectCompetitor(-1)">
        <div class="nav-card-image">
          <img [src]="getMainImage()" [alt]="propertyData.propertyName" (error)="onImageError($event)">
        </div>
        <div class="nav-card-content">
          <h4 [title]="propertyData.Listing_Name | summary:10">{{propertyData.Listing_Name | summary:10}}</h4>
          <span class="photo-count">{{propertyData.num_photos}} photos</span>
          <span class="gap-indicator">Your property</span>
        </div>
        <div class="nav-card-links">
          <i class="fas fa-link"></i>
        </div>
      </div>
      <!-- Selected Competitor Card (Always Second) -->
      <div class="nav-card" 
           [class.active]="selectedCompetitorIndex >= 0" 
           (click)="selectCompetitor(selectedCompetitorIndex >= 0 ? selectedCompetitorIndex : 0)">
        <div class="nav-card-image">
          <img [src]="getCurrentCompetitor()?.photos && getCurrentCompetitor()?.photos.length > 0 ? getCurrentCompetitor().photos[0].url : 'assets/images/placeholder.jpg'" 
               [alt]="getCurrentCompetitor()?.propertyName || 'Competitor'" 
               (error)="onImageError($event)">
        </div>
        <div class="nav-card-content">
          <h4 [title]="getCurrentCompetitor()?.propertyName || 'Select Competitor'">{{getCurrentCompetitor()?.propertyName | summary: 8}}</h4>
          <span class="photo-count">{{getCurrentCompetitor()?.num_photos || 0}} photos</span>
          <span class="gap-indicator" 
                [ngClass]="getGapClass((getCurrentCompetitor()?.num_photos || 0) - propertyData.num_photos)"
                *ngIf="getCurrentCompetitor()">
            {{(getCurrentCompetitor()?.num_photos || 0) - propertyData.num_photos > 0 ? '+' : ''}}{{(getCurrentCompetitor()?.num_photos || 0) - propertyData.num_photos}} {{(getCurrentCompetitor()?.num_photos || 0) - propertyData.num_photos > 0 ? 'more than you' : 'less than you'}}
          </span>
        </div>
        <div class="nav-card-links">
          <i class="fas fa-link"></i>
        </div>
      </div>
    </div>
    <button class="nav-arrow next" (click)="nextCompetitor()" [disabled]="selectedCompetitorIndex >= propertyData.competitor.length - 1">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>

  <!-- Main Comparison Layout -->
  <div class="comparison-layout" *ngIf="propertyData">
    <!-- Your Photos Section -->
    <div class="comparison-section your-photos">
      <div class="section-header">
        <h2 [title]="propertyData.Listing_Name">{{propertyData.Listing_Name}}</h2>
        <div class="review-summary">
    
          <!-- Amenities Section -->
            <div class="amenities-section">
              <div class="amenities-scores" *ngIf="(propertyData.amenitiesAirbnb && propertyData.amenitiesAirbnb.length > 0) || 
                                                    (propertyData.amenitiesBooking && propertyData.amenitiesBooking.length > 0) || 
                                                    (propertyData.amenitiesVrbo && propertyData.amenitiesVrbo.length > 0)">
                <!-- Airbnb Amenities -->
                <div class="platform-amenity-group" *ngIf="propertyData.amenitiesAirbnb && propertyData.amenitiesAirbnb.length > 0">
                  <i class="fab fa-airbnb platform-icon airbnb-icon"></i>
                  <span class="amenity-item" *ngFor="let amenity of propertyData.amenitiesAirbnb">
                    <i class="fas" [ngClass]="getAmenityIcon(amenity.icon)"></i>
                    {{amenity.title}}
                  </span>
                </div>
                
                <!-- Booking Amenities -->
                <div class="platform-amenity-group" *ngIf="propertyData.amenitiesBooking && propertyData.amenitiesBooking.length > 0">
                  <i class="fas fa-bed platform-icon booking-icon"></i>
                  <span class="amenity-item" *ngFor="let amenity of propertyData.amenitiesBooking">
                    <i class="fas" [ngClass]="getAmenityIcon(amenity.icon)"></i>
                    {{amenity.title}}
                  </span>
                </div>
                
                <!-- VRBO Amenities -->
                <div class="platform-amenity-group" *ngIf="propertyData.amenitiesVrbo && propertyData.amenitiesVrbo.length > 0">
                  <i class="fas fa-home platform-icon vrbo-icon"></i>
                  <span class="amenity-item" *ngFor="let amenity of propertyData.amenitiesVrbo">
                    <i class="fas" [ngClass]="getAmenityIcon(amenity.icon)"></i>
                    {{amenity.title}}
                  </span>
                </div>
              </div>
              <div class="no-amenities-message" *ngIf="!(propertyData.amenitiesAirbnb && propertyData.amenitiesAirbnb.length > 0) && 
                                                        !(propertyData.amenitiesBooking && propertyData.amenitiesBooking.length > 0) && 
                                                        !(propertyData.amenitiesVrbo && propertyData.amenitiesVrbo.length > 0)">
                No amenities found
              </div>
            </div>
        </div>
        <div class="photo-count">{{propertyData.num_photos}} photos</div>
      </div>
     


        <gallery [items]="images" bullets="true" bulletPosition='bottom' scrollBehavior='smooth' [ngStyle]="{'background-color': 'white', 'padding': '25px'}" gestures="true" imageSize='cover' counter="true" nav="true" itemAutosize="true" thumbs="true"  thumbPosition='bottom' id='your-photos-gallery'></gallery>
  
   
    </div>  

    <!-- Competitor Photos Section -->
    <div class="comparison-section competitor-photos" *ngIf="getCurrentCompetitor()">
      <div class="section-header">  
        <h2 [title]="getCurrentCompetitor().propertyName">{{getCurrentCompetitor().propertyName}}</h2>
        <div class="review-summary">
       
                <!-- Amenities Section -->
                <div class="amenities-section">
                  <div class="amenities-scores">
                    <!-- Airbnb Amenities -->
                    <div class="platform-amenity-group" *ngIf="getCurrentCompetitor().amenitiesAirbnb && getCurrentCompetitor().amenitiesAirbnb.length > 0">
                      <i class="fab fa-airbnb platform-icon airbnb-icon"></i>
                      <span class="amenity-item" *ngFor="let amenity of getCurrentCompetitor().amenitiesAirbnb">
                        <i class="fas" [ngClass]="getAmenityIcon(amenity.icon)"></i>
                        {{amenity.title}}
                      </span>
                    </div>
                    
                    <!-- Booking Amenities -->
                    <div class="platform-amenity-group" *ngIf="getCurrentCompetitor().amenitiesBooking && getCurrentCompetitor().amenitiesBooking.length > 0">
                      <i class="fas fa-bed platform-icon booking-icon"></i>
                      <span class="amenity-item" *ngFor="let amenity of getCurrentCompetitor().amenitiesBooking">
                        <i class="fas" [ngClass]="getAmenityIcon(amenity.icon)"></i>
                        {{amenity.title}}
                      </span>
                    </div>
                    
                    <!-- VRBO Amenities -->
                    <div class="platform-amenity-group" *ngIf="getCurrentCompetitor().amenitiesVrbo && getCurrentCompetitor().amenitiesVrbo.length > 0">
                      <i class="fas fa-home platform-icon vrbo-icon"></i>
                      <span class="amenity-item" *ngFor="let amenity of getCurrentCompetitor().amenitiesVrbo">
                        <i class="fas" [ngClass]="getAmenityIcon(amenity.icon)"></i>
                        {{amenity.title}}
                      </span>
                    </div>
                  </div>
                </div>
        </div>
        <div class="photo-count">{{getCurrentCompetitor().num_photos}} photos</div>
      </div>
 
      
        <gallery  [items]="competitorImages" bullets="true" bulletPosition='bottom' scrollBehavior='smooth' [ngStyle]="{'background-color': 'white', 'padding': '25px'}" gestures="true" imageSize='cover' counter="true" nav="true" itemAutosize="true" thumbs="true"  thumbPosition='bottom' id='competitor-photos-gallery'></gallery>
   
    </div>
  </div>

  <!-- Competitor Comparison -->
  <div class="competitor-section" *ngIf="propertyData?.competitor && propertyData.competitor.length > 0">
    <h2>Competitor Comparison</h2>
    <div class="competitor-grid">
      <div class="competitor-card" *ngFor="let comp of propertyData.competitor">
        <div class="competitor-header">
          <h3 [title]="comp.propertyName">{{comp.propertyName}}</h3>
          <div class="competitor-rating">
            <div class="platform-badges">
              <span class="badge airbnb-badge" *ngIf="comp.reviewsAirbnb && comp.reviewsAirbnb.length > 0">
                <i class="fab fa-airbnb"></i> {{comp.reviewsAirbnb.length}}
              </span>
              <span class="badge booking-badge" *ngIf="comp.reviewsBooking && comp.reviewsBooking.length > 0">
                <i class="fas fa-bed"></i> {{comp.reviewsBooking.length}}
              </span>
              <span class="badge vrbo-badge" *ngIf="comp.reviewsVrbo && comp.reviewsVrbo.length > 0">
                <i class="fas fa-home"></i> {{comp.reviewsVrbo.length}}
              </span>
            </div>
            <!-- <span class="reviews-count">({{comp.reviews_count}} reviews)</span> -->
          </div>
        </div>
        <div class="competitor-stats">
          <div class="platform-stats-table">
            <div class="table-header">
              <div class="header-cell">Platform</div>
              <div class="header-cell">Photos</div>
              <div class="header-cell">Photo Gap</div>
            </div>
            <div class="table-row airbnb-row">
              <div class="cell platform-cell">
                <i class="fab fa-airbnb"></i> Airbnb
              </div>
              <div class="cell">{{comp.propertyAirbnbPhotos?.length || 0}}</div>
              <div class="cell" [ngClass]="getGapClass((comp.propertyAirbnbPhotos?.length || 0) - (propertyData.Photos?.airbnb?.length || 0))">
                {{(comp.propertyAirbnbPhotos?.length || 0) - (propertyData.Photos?.airbnb?.length || 0) > 0 ? '+' : ''}}{{(comp.propertyAirbnbPhotos?.length || 0) - (propertyData.Photos?.airbnb?.length || 0)}}
              </div>
            </div>
            <div class="table-row booking-row">
              <div class="cell platform-cell">
                <i class="fas fa-bed"></i> Booking
              </div>
              <div class="cell">{{comp.propertyBookingPhotos?.length || 0}}</div>
              <div class="cell" [ngClass]="getGapClass((comp.propertyBookingPhotos?.length || 0) - (propertyData.Photos?.booking?.length || 0))">
                {{(comp.propertyBookingPhotos?.length || 0) - (propertyData.Photos?.booking?.length || 0) > 0 ? '+' : ''}}{{(comp.propertyBookingPhotos?.length || 0) - (propertyData.Photos?.booking?.length || 0)}}
              </div>
            </div>
            <div class="table-row vrbo-row">
              <div class="cell platform-cell">
                <i class="fas fa-home"></i> VRBO
              </div>
              <div class="cell">{{comp.propertyVrboPhotos?.length || 0}}</div>
              <div class="cell" [ngClass]="getGapClass((comp.propertyVrboPhotos?.length || 0) - (propertyData.Photos?.vrbo?.length || 0))">
                {{(comp.propertyVrboPhotos?.length || 0) - (propertyData.Photos?.vrbo?.length || 0) > 0 ? '+' : ''}}{{(comp.propertyVrboPhotos?.length || 0) - (propertyData.Photos?.vrbo?.length || 0)}}
              </div>
            </div>
          </div>
        </div>
        <div class="competitor-links">
          <a [href]="comp.airbnb_link" target="_blank" class="platform-link airbnb">
            <i class="fab fa-airbnb"></i>
          </a>
          <a [href]="comp.booking_link" target="_blank" class="platform-link booking">
            <i class="fas fa-bed"></i>
          </a>
          <a *ngIf="comp.pricelabs_link" [href]="comp.pricelabs_link" target="_blank" class="platform-link pricelab" title="View on Pricelab">
            <i class="fas fa-chart-line"></i>
          </a>
          <span *ngIf="!comp.pricelabs_link" class="platform-link pricelab disabled" title="No Pricelab URL available">
            <i class="fas fa-chart-line"></i>
          </span>
          <!-- <a [href]="comp.vrbo_link" target="_blank" class="platform-link vrbo">
            <i class="fas fa-home"></i>
          </a> -->
        </div>
      </div>
    </div>
  </div>

  <!-- Additional Photo Suggestions -->
  <div class="photo-suggestions-section" *ngIf="getPhotoSuggestions().length > 0">
    <div class="suggestions-header">
      <h2>Additional photo suggestions</h2>
    </div>
    <div class="suggestions-list">
      <div class="suggestion-item" *ngFor="let suggestion of getPhotoSuggestions()">
        <div class="suggestion-status">
          <i class="fas" [ngClass]="suggestion.available ? 'fa-check' : 'fa-times'" 
             [class.status-available]="suggestion.available" 
             [class.status-unavailable]="!suggestion.available"></i>
        </div>
        <div class="suggestion-content">
          <div class="suggestion-main">
            <span class="suggestion-title">{{suggestion.title}}</span>
            <div class="suggestion-meta" *ngIf="suggestion.impact && suggestion.effort">
              <span class="impact-badge" [ngClass]="'impact-' + suggestion.impact">{{suggestion.impact}} impact</span>
              <span class="effort-badge" [ngClass]="'effort-' + suggestion.effort">{{suggestion.effort}} effort</span>
            </div>
          </div>
          <div class="info-icon-container">
            <i class="fas fa-info-circle info-icon" 
               (click)="showSuggestionInfo(suggestion)"></i>
            <div class="tooltip">{{suggestion.description}}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  

  <!-- Photo Gallery -->
  <!-- <div class="photo-gallery" *ngIf="propertyData?.property_photos">
    <h2>Photo Gallery</h2>
    <div class="gallery-grid">
      <div class="photo-item" *ngFor="let photo of propertyData.property_photos; let i = index" (click)="openPhotoModal(i)">
        <img [src]="photo.url" [alt]="photo.caption || 'Property photo'" (error)="onImageError($event)">
        <div class="photo-overlay">
          <div class="photo-info">
            <span class="photo-type">{{photo.type}}</span>
            <span class="photo-caption" *ngIf="photo.caption">{{photo.caption}}</span>
            <span class="no-caption" *ngIf="!photo.caption">
              <i class="fas fa-exclamation-triangle"></i>
              No Caption
            </span>
          </div>
        </div>
      </div>
    </div>
  </div> -->

  <!-- Missing Captions Section -->
  <div class="missing-captions-section" *ngIf="propertyData?.missing_captions > 0">
    <h2>Missing Captions</h2>
    <div class="missing-list">
      <div class="missing-item" *ngFor="let photoId of getMissingCaptionPhotos()">
        <i class="fas fa-exclamation-triangle"></i>
        <span>Photo {{photoId}} needs a caption</span>
        <button class="btn btn-sm btn-primary" (click)="openCaptionModal(photoId)">Add Caption</button>
      </div>
    </div>
  </div>
    </div>

    <!-- Competitor Reviews Tab -->
    <div class="tab-pane" [class.active]="activeTab === 'competitor-reviews'" *ngIf="activeTab === 'competitor-reviews'">
      <app-competitor-reviews></app-competitor-reviews>
    </div>

    <!-- My Reviews Tab -->
    <div class="tab-pane" [class.active]="activeTab === 'my-reviews'" *ngIf="activeTab === 'my-reviews'">
      <app-my-reviews></app-my-reviews>
    </div>

    <!-- Amenities Analyser Tab -->
    <div class="tab-pane" [class.active]="activeTab === 'amenities'" *ngIf="activeTab === 'amenities'">
      <app-amenities-analyzer></app-amenities-analyzer>
    </div>
  </div>
</div>

<!-- Photo Modal -->
<div class="photo-modal" *ngIf="selectedPhotoIndex !== null" (click)="closePhotoModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closePhotoModal()">
      <i class="fas fa-times"></i>
    </button>
    <div class="modal-image">
      <img [src]="getSelectedPhoto()?.url" [alt]="getSelectedPhoto()?.caption" (error)="onImageError($event)">
    </div>
    <div class="modal-info">
      <h3>{{getSelectedPhoto()?.type}}</h3>
      <p *ngIf="getSelectedPhoto()?.caption">{{getSelectedPhoto()?.caption}}</p>
      <p *ngIf="!getSelectedPhoto()?.caption" class="no-caption">
        <i class="fas fa-exclamation-triangle"></i>
        This photo needs a caption
      </p>
    </div>
    <div class="modal-navigation">
      <button class="nav-btn prev" (click)="previousPhoto()" *ngIf="selectedPhotoIndex > 0">
        <i class="fas fa-chevron-left"></i>
      </button>
      <button class="nav-btn next" (click)="nextPhoto()" *ngIf="selectedPhotoIndex < propertyData.property_photos.length - 1">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
</div>

<!-- Caption Modal -->
<div class="caption-modal" *ngIf="showCaptionModal" (click)="closeCaptionModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Add Caption</h3>
      <button class="close-btn" (click)="closeCaptionModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <div class="property-info">
        <h4 [title]="propertyData?.listing_name || 'Property'">{{ propertyData?.listing_name || 'Property' }}</h4>
        <p class="photo-id">Photo ID: {{ selectedPhotoId }}</p>
      </div>
      <div class="form-group">
        <label for="caption-textarea">Caption</label>
        <textarea 
          id="caption-textarea"
          class="form-control" 
          [(ngModel)]="captionText" 
          placeholder="Enter a descriptive caption for this photo..."
          rows="4"
          [disabled]="isSubmittingCaption">
        </textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button 
        type="button" 
        class="btn btn-secondary" 
        (click)="closeCaptionModal()"
        [disabled]="isSubmittingCaption">
        Cancel
      </button>
      <button 
        type="button" 
        class="btn btn-primary" 
        (click)="submitCaption()"
        [disabled]="isSubmittingCaption || !captionText.trim()">
        <span *ngIf="isSubmittingCaption" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
        {{ isSubmittingCaption ? 'Adding...' : 'Add Caption' }}
      </button>
    </div>
  </div>
</div>